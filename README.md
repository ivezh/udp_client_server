**Проект: UDP-сервер для работы с VLAN-MAC таблицей**  
*(Work in progress!)*  
---

## Архитектура проекта  
- **Сервер**:  
  - Читает CSV-файл с парами `VLAN-ID + MAC-адрес`.  
  - Сортирует данные по VLAN-ID.
  - Обслуживает UDP-запросы клиентов: выдает N записе.
  - Использует `epoll` для обработки множества клиентов в однопоточном режиме.  
- **Клиент**:  
  - Запрашивает данные у сервера.  
  - Поддерживает вывод N записей (`q` — выход, `Space + N` или просто `N` - вывод другого кол-ва пар vlan_id/mac).  

---

## Что реализовано  
1. **Загрузка и хранение данных**:  
   - Чтение CSV-файла построчно. 
   - Хранение данных в массиве структур `VlanMacEntry`.  
2. **Сортировка**:  
   - Реализован алгоритм **counting sort** для сортировки по VLAN-ID.  
   - Позволяет сортировать за `O(N)` за счет использования счетчика и предварительного вычисления индексов.  
3. **UDP-взаимодействие**:  
   - Сервер принимает и обрабатывает UDP-запросы.  
   - Клиент отправляет запросы и выводит полученные данные.  
4. **Однопоточность с epoll**:  
   - Использование `epoll` для асинхронной обработки событий.  
   - Неблокирующий сокет для избежания зависания на одном клиенте.  
5. **Базовая обработка ошибок**:  
   - Проверка корректности входного файла.  
   - Ограничение размера пакета до 40 строк в пакете
---

## Что осталось доделать  
1. **Пагинция**  
2. **Обработка ошибок в `sendto()` и `recvfrom()`**:  
   - Учет `EMSGSIZE` (пакет слишком большой), `EAGAIN` (переполнение буфера).  
3. **Оптимизация для больших запросов**:  
   - Добавить буферизацию и ограничение скорости передачи, т.к. сейчас при запросе 1 млн. пар теряется примерно 12% данных на клиенте   
4. **Документация**:  
   - Добавить комментарии в код.  
5. **Организовать код: вынести функции в отдельные .h и т.п.**
---

## Известные баги  
1. **Потеря пакетов при высокой нагрузке**:  
   - При отправке 1 млн записей теряется ~12% данных.
   - Мусорные символы в выдаче на клиенте (очень редко).

---
## Описание алгоритма сортировки  
### Используемый метод: **Counting Sort**  
#### Почему выбран:
- VLAN-ID имеют ограниченный диапазон (1–4094, в соответствии с RFC 2674).  
- Counting Sort работает за `O(N + K)`, где `K = 4094`.  

#### Преимущества:  
- Линейная сложность.  
- Минимизация вызовов `malloc` (используется всего 2 выделения памяти).  
---

## Сборка  
### Требования:  
- Компилятор C (например, `gcc`).  
- Библиотеки: `sys/socket.h`, `netinet/in.h`, `arpa/inet.h`.  

### Компиляция:  
- и для клиента и для сервера подготовлены Makefile для сборки

### Запуск:  
```bash
# 1. Генерация CSV с тестовыми данными в папке с сервером
python ./test generate_csv_vlan_mac.py

# 2. Сервер читает файл vlan_data.csv на старте и выводит номер порта
./server

# 3. Клиент на старте считывает IP и порт сервера 
./client 127.0.0.1 {server_port}
```